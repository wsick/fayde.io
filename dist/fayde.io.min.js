var Fayde;!function(e){var t;!function(e){e.version="0.1.0"}(t=e.IO||(e.IO={}))}(Fayde||(Fayde={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n},Fayde;!function(e){var t;!function(t){function n(e,t){var n=document.createElement("input");return n.type="file",n.multiple=e===!0,n.accept=t||void 0,n.style.opacity="0.0",document.body.appendChild(n),n}var o=e.Controls.ContentControl,r=e.Collections.ObservableCollection,i=e.Controls.Primitives.ButtonBase,l=function(e){function o(){e.call(this),this.FilesChanged=new nullstone.Event,this.$element=null,this.$button=null,this.DefaultStyleKey=o,this.SetCurrentValue(o.FilesProperty,new r)}return __extends(o,e),o.prototype.OnApplyTemplate=function(){e.prototype.OnApplyTemplate.call(this),this.$button=this.GetTemplateChild("BrowseButton",i),this.$button&&this.$button.Click.on(this.Open,this)},o.prototype.OnIsMultipleChanged=function(e,t){var n=this.$element;n&&(n.multiple=t===!0)},o.prototype.OnFilterChanged=function(e,t){var n=this.$element;n&&(n.accept=t||void 0)},o.prototype.Open=function(){var e=this.$element;if(!e){e=this.$element=n(this.IsMultiple,this.Filter);var t=this;e.addEventListener("change",function(){t.OnFilesChanged(this.files)},!1)}e.files=null,e.click()},o.prototype.OnFilesChanged=function(e){for(var n=[],o=0;o<e.length;o++)n.push(e[o]);var r=this.Files.ToArray();this.Files.Clear(),this.Files.AddRange(n),this.FilesChanged.raise(this,new t.FilesChangedEventArgs(r,n))},o.IsMultipleProperty=DependencyProperty.Register("IsMultiple",function(){return Boolean},o,!1,function(e,t){return e.OnIsMultipleChanged(t.OldValue,t.NewValue)}),o.FilterProperty=DependencyProperty.Register("Filter",function(){return String},o,void 0,function(e,t){return e.OnFilterChanged(t.OldValue,t.NewValue)}),o.FilesProperty=DependencyProperty.RegisterReadOnly("Files",function(){return r},o),o}(o);t.FileControl=l,e.Controls.TemplateParts(l,{Name:"BrowseButton",Type:i})}(t=e.IO||(e.IO={}))}(Fayde||(Fayde={}));var Fayde;!function(e){var t;!function(e){!function(e){e[e.Complete=1]="Complete",e[e.Progress=2]="Progress",e[e.Failed=4]="Failed",e[e.Cancelled=8]="Cancelled"}(e.UploadReporting||(e.UploadReporting={}));var t=e.UploadReporting;e.IUploader_=new nullstone.Interface("IUploader"),e.IUploader_.is=function(e){return e&&"function"==typeof e.Upload};var n=function(){function n(){var t=this;this.Progressed=new nullstone.Event,this.Completed=new nullstone.Event,this.Failed=new nullstone.Event,this.Cancelled=new nullstone.Event,this.$active=null,this._OnUploadComplete=function(e){t.Completed.raise(t,{})},this._OnUploadProgress=function(n){t.Progressed.raise(t,new e.ProgressedEventArgs(n.loaded,n.total))},this._OnUploadErrored=function(n){t.Failed.raise(t,new e.FailedEventArgs(n))},this._OnUploadAborted=function(e){t.Cancelled.raise(t,{})}}return Object.defineProperty(n.prototype,"Reporting",{get:function(){return t.Complete|t.Progress|t.Failed|t.Cancelled},enumerable:!0,configurable:!0}),n.prototype.Upload=function(e,t,n,o){if(this.$active)throw new Error("Uploader can only upload once.");var r=this.$active=new XMLHttpRequest;r.open("POST",e,!0),r.setRequestHeader("X-File-Name",n),r.setRequestHeader("X-File-Type",o),r.upload&&(r.upload.addEventListener("load",this._OnUploadComplete,!1),r.upload.addEventListener("progress",this._OnUploadProgress,!1),r.upload.addEventListener("error",this._OnUploadErrored,!1),r.upload.addEventListener("abort",this._OnUploadAborted,!1));var i=new FormData;i.append("image",t),r.send(i)},n}();e.Uploader=n}(t=e.IO||(e.IO={}))}(Fayde||(Fayde={}));var Fayde;!function(e){var t;!function(t){var n=e.Controls.Control,o=e.Controls.ItemsControl,r=e.Collections.ObservableCollection,i=e.Controls.Primitives.ButtonBase,l=function(n){function o(){n.call(this),this.$control=null,this.$upload=null,this.DefaultStyleKey=o,this.SetCurrentValue(o.ItemsProperty,new r)}return __extends(o,n),o.prototype.OnUploaderTypeChanged=function(e,n){var r=!0;if(n&&"function"==typeof n){var i=t.IUploader_.as(new n);r=!!i&&0===(i.Reporting&t.UploadReporting.Progress)}else r=!1;this.SetCurrentValue(o.HasNoProgressProperty,!r)},o.prototype.CreateUploader=function(){return new this.UploaderType},o.prototype.OnApplyTemplate=function(){n.prototype.OnApplyTemplate.call(this),this.$control&&this.$control.FilesChanged.off(this._OnFilesChanged,this),this.$control=this.GetTemplateChild("FileControl",t.FileControl),this.$control&&this.$control.FilesChanged.on(this._OnFilesChanged,this),this.$upload&&this.$upload.Click.off(this._OnStart,this),this.$upload=this.GetTemplateChild("UploadButton",i),this.$upload&&this.$upload.Click.on(this._OnStart,this)},o.prototype._OnFilesChanged=function(e,n){this.Items.Clear(),this.Items.AddRange(n.NewFiles.map(function(e){return new t.FileUploadItem(e)}))},o.prototype._OnStart=function(e,t){var n;if(!this.UploadUri||!(n=this.UploadUri.toString()))return void console.warn("Cannot upload with UploadUri set.");for(var o=this.Items.getEnumerator();o.moveNext();)o.current.Upload(n,this.CreateUploader())},o.ItemsProperty=DependencyProperty.RegisterReadOnly("Items",function(){return r},o),o.UploaderTypeProperty=DependencyProperty.Register("UploaderType",function(){return Function},o,t.Uploader,function(e,t){return e.OnUploaderTypeChanged(t.OldValue,t.NewValue)}),o.HasNoProgressProperty=DependencyProperty.RegisterReadOnly("HasNoProgress",function(){return Boolean},o,!1),o.UploadUriProperty=DependencyProperty.Register("UploadUri",function(){return e.Uri},o),o}(n);t.FileUploadControl=l,e.Controls.TemplateParts(l,{Name:"FileControl",Type:t.FileControl},{Name:"UploadButton",Type:i},{Name:"ItemsProgress",Type:o})}(t=e.IO||(e.IO={}))}(Fayde||(Fayde={}));var Fayde;!function(e){var t;!function(t){var n=e.MVVM.ObservableObject,o=function(e){function t(t){e.call(this),this.UploadProgress=0,this.IsUploading=!1,this.UploadStatus="",this.UploadError=null,this.$file=t}return __extends(t,e),Object.defineProperty(t.prototype,"Size",{get:function(){return this.$file?this.$file.size:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Name",{get:function(){return this.$file?this.$file.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Type",{get:function(){return this.$file?this.$file.type:""},enumerable:!0,configurable:!0}),t.prototype.Upload=function(e,t){this.IsUploading=!0,t.Cancelled.on(this._OnCancelled,this),t.Completed.on(this._OnCompleted,this),t.Progressed.on(this._OnProgressed,this),t.Failed.on(this._OnFailed,this),t.Upload(e,this.$file,this.Name,this.Type)},t.prototype._OnCancelled=function(){this.UploadStatus="Cancelled",this.IsUploading=!1},t.prototype._OnCompleted=function(){this.UploadStatus="Completed",this.IsUploading=!1},t.prototype._OnProgressed=function(e,t){this.UploadStatus="",this.UploadProgress=t.Loaded/t.Total},t.prototype._OnFailed=function(e,t){this.UploadStatus="Failed",this.UploadError=t.Error,this.IsUploading=!1},t}(n);t.FileUploadItem=o,e.MVVM.NotifyProperties(o,["UploadProgress","IsUploading","UploadStatus","UploadError"])}(t=e.IO||(e.IO={}))}(Fayde||(Fayde={}));var Fayde;!function(e){var t;!function(e){var t=function(){function e(e,t){Object.defineProperties(this,{OldFiles:{value:e,writable:!1},NewFiles:{value:t,writable:!1}})}return e}();e.FilesChangedEventArgs=t}(t=e.IO||(e.IO={}))}(Fayde||(Fayde={}));var Fayde;!function(e){var t;!function(t){function n(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}var o=Math.pow(2,40),r=Math.pow(2,30),i=Math.pow(2,20),l=Math.pow(2,10),a=.9,s=function(){function e(){}return e.prototype.Convert=function(e,t,s,p){var d;return(d=e/o)>a?n(d,2).toString()+"TB":(d=e/r)>a?n(d,2).toString()+"GB":(d=e/i)>a?n(d,2).toString()+"MB":(d=e/l)>a?n(d,2).toString()+"KB":e},e.prototype.ConvertBack=function(e,t,n,o){return e},e}();t.SizeConverter=s,e.Data.IValueConverter_.mark(s)}(t=e.IO||(e.IO={}))}(Fayde||(Fayde={}));var Fayde;!function(e){var t;!function(e){var t=function(){function e(e){Object.defineProperties(this,{Error:{value:e,writable:!1}})}return e}();e.FailedEventArgs=t}(t=e.IO||(e.IO={}))}(Fayde||(Fayde={}));var Fayde;!function(e){var t;!function(e){var t=function(){function e(e,t){Object.defineProperties(this,{Loaded:{value:e,writable:!1},Total:{value:t,writable:!1}})}return e}();e.ProgressedEventArgs=t}(t=e.IO||(e.IO={}))}(Fayde||(Fayde={}));
//# sourceMappingURL=fayde.io.min.js.map